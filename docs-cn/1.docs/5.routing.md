---
icon: ri:direction-line
---

# è·¯ç”±

> Nitro æ”¯æŒæ–‡ä»¶ç³»ç»Ÿè·¯ç”±ï¼Œè‡ªåŠ¨å°†æ–‡ä»¶æ˜ å°„åˆ°è·¯ç”±ã€‚é€šè¿‡å°†ä»£ç åˆ†å‰²ä¸ç¼–è¯‘è·¯ç”±ç›¸ç»“åˆï¼Œå®ƒæ¶ˆé™¤äº†å¯¹ runtime router çš„éœ€æ±‚ï¼Œåªä¿ç•™äº†æœ€å°çš„ç¼–è¯‘é€»è¾‘ã€‚

::warning
Nitro v3 Alpha æ–‡æ¡£ä»åœ¨å¼€å‘ä¸­â€”â€”å¯èƒ½ä¼šæœ‰æ›´æ–°ã€ä¸å®Œå–„çš„åœ°æ–¹å’Œå¶å°”çš„ä¸å‡†ç¡®ä¿¡æ¯ã€‚
::

## è¯·æ±‚å¤„ç†å™¨

Nitro è¯·æ±‚å¤„ç†å™¨æ˜¯ä¸€ä¸ªæ¥å— `event` å¯¹è±¡çš„å‡½æ•°ï¼Œè¯¥å¯¹è±¡æ˜¯ä¸€ä¸ª [H3Event](https://h3.dev/guide/api/h3event#h3event-properties) å¯¹è±¡ã€‚

::code-group
```ts [å•ä¸€å‡½æ•°]
import type { H3Event } from "nitro/h3";

export default (event: H3Event) => {
  return "world";
}
```
```ts [defineHandler]
import { defineHandler } from "nitro/h3";

// ä¸ºäº†æ›´å¥½çš„ç±»å‹æ¨æ–­
export default defineHandler((event) => {
  return "world";
});
```
::

## æ–‡ä»¶ç³»ç»Ÿè·¯ç”±

Nitro ä¸º API routes æ”¯æŒåŸºäºæ–‡ä»¶çš„è·¯ç”±ï¼ˆæ–‡ä»¶è‡ªåŠ¨æ˜ å°„åˆ° [h3 routes](https://h3.dev/guide/basics/routing)ï¼‰ã€‚å®šä¹‰è·¯ç”±å°±åƒåœ¨ `api/` æˆ– `routes/` ç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶ä¸€æ ·ç®€å•ã€‚

æ¯ä¸ªæ–‡ä»¶åªèƒ½å®šä¹‰ä¸€ä¸ª handlerï¼Œå¯å°† [HTTP æ–¹æ³•é™„åŠ ](#ç‰¹å®šè¯·æ±‚æ–¹æ³•)åˆ°æ–‡ä»¶åæ¥å®šä¹‰ç‰¹å®šçš„è¯·æ±‚æ–¹æ³•ã€‚

```
routes/
  api/
    test.ts      <-- /api/test
  hello.get.ts   <-- /hello (ä»… GET)
  hello.post.ts  <-- /hello (ä»… POST)
vite.config.ts
```

é€šè¿‡åˆ›å»ºå­ç›®å½•åµŒå¥—è·¯ç”±ã€‚

```txt
routes/
  api/
    [org]/
      [repo]/
        index.ts   <-- /api/:org/:repo
        issues.ts  <-- /api/:org/:repo/issues
      index.ts     <-- /api/:org
package.json
```

### é™æ€è·¯ç”±

é¦–å…ˆï¼Œåœ¨ `routes/` æˆ– `routes/api/` ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚æ–‡ä»¶åå°†æ˜¯è·¯ç”±è·¯å¾„ã€‚

ç„¶åï¼Œå¯¼å‡ºä¸€ä¸ª fetch å…¼å®¹çš„å‡½æ•°ï¼š

```ts [routes/api/test.ts]
import { defineHandler } from "nitro/h3";

export default defineHandler(() => {
  return { hello: "API" };
});
```

### åŠ¨æ€è·¯ç”±

#### å•ä¸ªå‚æ•°

è¦å®šä¹‰å¸¦æœ‰å‚æ•°çš„è·¯ç”±ï¼Œä½¿ç”¨ `[<param>]` è¯­æ³•ï¼Œå…¶ä¸­ `<param>` æ˜¯å‚æ•°çš„åç§°ã€‚å‚æ•°å°†åœ¨ `event.context.params` å¯¹è±¡ä¸­å¯ç”¨ï¼Œæˆ–ä½¿ç”¨ [`getRouterParam`](https://h3.dev/utils/request#getrouterparamevent-name-opts-decode) å®ç”¨ç¨‹åºã€‚

```ts [routes/hello/[name\\].ts]
import { defineHandler } from "nitro/h3";

export default defineHandler((event) => {
  const { name } = event.context.params;

  return `Hello ${name}!`;
});
```

ä½¿ç”¨å‚æ•° `/hello/nitro` è°ƒç”¨è·¯ç”±ï¼Œä½ å°†å¾—åˆ°ï¼š

```txt [Response]
Hello nitro!
```

#### å¤šä¸ªå‚æ•°

ä½ å¯ä»¥ä½¿ç”¨ `[<param1>]/[<param2>]` è¯­æ³•åœ¨è·¯ç”±ä¸­å®šä¹‰å¤šä¸ªå‚æ•°ï¼Œå…¶ä¸­æ¯ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ä½ **ä¸èƒ½**åœ¨å•ä¸ªæ–‡ä»¶åæˆ–æ–‡ä»¶å¤¹ä¸­å®šä¹‰å¤šä¸ªå‚æ•°ã€‚

```ts [routes/hello/[name\\]/[age\\].ts]
import { defineHandler } from "nitro/h3";

export default defineHandler((event) => {
  const { name, age } = event.context.params;

  return `Hello ${name}! You are ${age} years old.`;
});
```

#### æ•è·æ‰€æœ‰å‚æ•°

ä½ å¯ä»¥ä½¿ç”¨ `[...<param>]` è¯­æ³•æ•è· URL çš„æ‰€æœ‰å‰©ä½™éƒ¨åˆ†ã€‚è¿™å°†åŒ…æ‹¬ `/` åœ¨å‚æ•°ä¸­ã€‚

```ts [routes/hello/[...name\\].ts]
import { defineHandler } from "nitro/h3";

export default defineHandler((event) => {
  const { name } = event.context.params;

  return `Hello ${name}!`;
});
```

ä½¿ç”¨å‚æ•° `/hello/nitro/is/hot` è°ƒç”¨è·¯ç”±ï¼Œä½ å°†å¾—åˆ°ï¼š

```txt [Response]
Hello nitro/is/hot!
```

### ç‰¹å®šè¯·æ±‚æ–¹æ³•

ä½ å¯ä»¥å°† HTTP æ–¹æ³•é™„åŠ åˆ°æ–‡ä»¶åï¼Œä»¥å¼ºåˆ¶è·¯ç”±ä»…åŒ¹é…ç‰¹å®šçš„ HTTP è¯·æ±‚æ–¹æ³•ï¼Œä¾‹å¦‚ `hello.get.ts` å°†ä»…åŒ¹é… `GET` è¯·æ±‚ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ æƒ³è¦çš„ HTTP æ–¹æ³•ã€‚

::code-group
```js [GET]
// routes/users/[id].get.ts
import { defineHandler } from "nitro/h3";

export default defineHandler(async (event) => {
  const { id } = event.context.params;

  // å¯¹ id åšä¸€äº›æ“ä½œ

  return `User profile!`;
});
```

```js [POST]
// routes/users.post.ts
import { defineHandler, readBody } from "nitro/h3";

export default defineHandler(async (event) => {
  const body = await readBody(event);

  // å¯¹ body åšä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ä¿å­˜åˆ°æ•°æ®åº“

  return { updated: true };
});
```
::

### æ•è·æ‰€æœ‰è·¯ç”±

ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„è·¯ç”±ï¼Œå®ƒå°†åŒ¹é…æ‰€æœ‰æœªè¢«ä»»ä½•å…¶ä»–è·¯ç”±åŒ¹é…çš„è·¯ç”±ã€‚è¿™å¯¹äºåˆ›å»ºé»˜è®¤è·¯ç”±å¾ˆæœ‰ç”¨ã€‚

è¦åˆ›å»ºæ•è·æ‰€æœ‰è·¯ç”±ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `[...].ts` çš„æ–‡ä»¶ã€‚

```ts [routes/[...\\].ts]
import { defineHandler } from "nitro/h3";

export default defineHandler((event) => {
  return `Hello ${event.url}!`;
});
```

### ç¯å¢ƒç‰¹å®šçš„å¤„ç†å™¨

ä½ å¯ä»¥é€šè¿‡å‘æ–‡ä»¶åæ·»åŠ  `.dev`ã€`.prod` æˆ– `.prerender` åç¼€æ¥æŒ‡å®šä»…åœ¨ç‰¹å®šæ„å»ºä¸­åŒ…å«çš„è·¯ç”±ï¼Œä¾‹å¦‚ï¼š`routes/test.get.dev.ts` æˆ– `routes/test.get.prod.ts`ã€‚

> [!TIP]
> ä½ å¯ä»¥é€šè¿‡ `handlers[]` é…ç½®çš„ç¨‹åºåŒ–è·¯ç”±æ³¨å†Œæ¥æŒ‡å®šå¤šä¸ªç¯å¢ƒæˆ–å°†é¢„è®¾åç§°æŒ‡å®šä¸ºç¯å¢ƒã€‚

## ä¸­é—´ä»¶

Nitro è·¯ç”±ä¸­é—´ä»¶å¯ä»¥é’©å…¥è¯·æ±‚ç”Ÿå‘½å‘¨æœŸã€‚

::tip
ä¸­é—´ä»¶å¯ä»¥åœ¨è¯·æ±‚è¢«å¤„ç†ä¹‹å‰ä¿®æ”¹è¯·æ±‚ï¼Œè€Œä¸æ˜¯ä¹‹åã€‚
::

ä¸­é—´ä»¶åœ¨ `middleware/` ç›®å½•ä¸­è‡ªåŠ¨æ³¨å†Œã€‚

```md
middleware/
  auth.ts
  logger.ts
  ...
routes/
  hello.ts
```

### ç®€å•ä¸­é—´ä»¶

ä¸­é—´ä»¶çš„å®šä¹‰ä¸è·¯ç”±å¤„ç†å™¨å®Œå…¨ç›¸åŒï¼Œå”¯ä¸€çš„ä¾‹å¤–æ˜¯å®ƒä»¬ä¸åº”è¯¥è¿”å›ä»»ä½•å†…å®¹ã€‚
ä»ä¸­é—´ä»¶è¿”å›çš„è¡Œä¸ºå°±åƒä»è¯·æ±‚è¿”å›ä¸€æ ·â€”â€”è¿”å›çš„å€¼å°†ä½œä¸ºå“åº”è¿”å›ï¼Œå¹¶ä¸”ä¸ä¼šè¿è¡Œè¿›ä¸€æ­¥çš„ä»£ç ã€‚

```ts [middleware/auth.ts]
import { defineHandler } from "nitro/h3";

export default defineHandler((event) => {
  // æ‰©å±•æˆ–ä¿®æ”¹ event
  event.context.user = { name: "Nitro" };
});
```

`middleware/` ç›®å½•ä¸­çš„ä¸­é—´ä»¶ä¼šè‡ªåŠ¨ä¸ºæ‰€æœ‰è·¯ç”±æ³¨å†Œã€‚å¦‚æœä½ æƒ³ä¸ºç‰¹å®šè·¯ç”±æ³¨å†Œä¸­é—´ä»¶ï¼Œè¯·å‚é˜…[å¯¹è±¡è¯­æ³•äº‹ä»¶å¤„ç†å™¨](https://h3.dev/guide/basics/handler#object-syntax)ã€‚

::note
ä»ä¸­é—´ä»¶è¿”å›ä»»ä½•å†…å®¹éƒ½ä¼šå…³é—­è¯·æ±‚ï¼Œåº”è¯¥é¿å…ï¼ä»ä¸­é—´ä»¶è¿”å›çš„ä»»ä½•å€¼éƒ½å°†æ˜¯å“åº”ï¼Œå¹¶ä¸”ä¸ä¼šæ‰§è¡Œè¿›ä¸€æ­¥çš„ä»£ç ï¼Œä½†æ˜¯**ä¸å»ºè®®è¿™æ ·åšï¼**
::

### è·¯ç”±å…ƒæ•°æ®

ä½ å¯ä»¥åœ¨äº‹ä»¶å¤„ç†å™¨æ–‡ä»¶ä¸­ä½¿ç”¨ `defineRouteMeta` å®åœ¨æ„å»ºæ—¶å®šä¹‰è·¯ç”±å¤„ç†å™¨å…ƒæ•°æ®ã€‚

> [!IMPORTANT]
> ğŸš§ æ­¤åŠŸèƒ½ç›®å‰æ˜¯å®éªŒæ€§çš„ã€‚

```ts [routes/api/test.ts]
import { defineRouteMeta } from "nitro/runtime";
import { defineHandler } from "nitro/h3";

defineRouteMeta({
  openAPI: {
    tags: ["test"],
    description: "æµ‹è¯•è·¯ç”±æè¿°",
    parameters: [{ in: "query", name: "test", required: true }],
  },
});

export default defineHandler(() => "OK");
```

::read-more{to="https://swagger.io/specification/v3/"}
æ­¤åŠŸèƒ½ç›®å‰å¯ç”¨äºæŒ‡å®š OpenAPI å…ƒæ•°æ®ã€‚æœ‰å…³å¯ç”¨çš„ OpenAPI é€‰é¡¹ï¼Œè¯·å‚é˜… swagger è§„èŒƒã€‚
::

### æ‰§è¡Œé¡ºåº

ä¸­é—´ä»¶æŒ‰ç›®å½•åˆ—è¡¨é¡ºåºæ‰§è¡Œã€‚

```md
middleware/
  auth.ts <-- ç¬¬ä¸€ä¸ª
  logger.ts <-- ç¬¬äºŒä¸ª
  ... <-- ç¬¬ä¸‰ä¸ª
```

ä½¿ç”¨æ•°å­—å‰ç¼€æ¥æ§åˆ¶å®ƒä»¬çš„æ‰§è¡Œé¡ºåºã€‚

```md
middleware/
  1.logger.ts <-- ç¬¬ä¸€ä¸ª
  2.auth.ts <-- ç¬¬äºŒä¸ª
  3.... <-- ç¬¬ä¸‰ä¸ª
```
::note
è¯·è®°ä½ï¼Œæ–‡ä»¶åæŒ‰å­—ç¬¦ä¸²æ’åºï¼Œå› æ­¤ä¾‹å¦‚å¦‚æœä½ æœ‰ 3 ä¸ªæ–‡ä»¶ `1.filename.ts`ã€`2.filename.ts` å’Œ `10.filename.ts`ï¼Œ`10.filename.ts` å°†åœ¨ `1.filename.ts` ä¹‹åã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¦‚æœä½ åœ¨åŒä¸€ç›®å½•ä¸­æœ‰è¶…è¿‡ 10 ä¸ªä¸­é—´ä»¶ï¼Œè¯·åœ¨ `1-9` å‰åŠ ä¸Š `0`ï¼Œå¦‚ `01`ã€‚
::

### è¯·æ±‚è¿‡æ»¤

ä¸­é—´ä»¶åœ¨æ¯ä¸ªè¯·æ±‚ä¸Šæ‰§è¡Œã€‚

åº”ç”¨è‡ªå®šä¹‰é€»è¾‘å°†å®ƒä»¬èŒƒå›´é™å®šåˆ°ç‰¹å®šæ¡ä»¶ã€‚

ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ URL å°†ä¸­é—´ä»¶åº”ç”¨åˆ°ç‰¹å®šè·¯ç”±ï¼š

```ts [middleware/auth.ts]
import { defineHandler } from "nitro/h3";

export default defineHandler((event) => {
  // åªä¼šä¸º /auth è·¯ç”±æ‰§è¡Œ
  if (event.url.pathname.startsWith('/auth')) {
    event.context.user = { name: "Nitro" };
  }
});
```

## é”™è¯¯å¤„ç†

ä½ å¯ä»¥ä½¿ç”¨ [H3 ä¸­å¯ç”¨çš„å®ç”¨ç¨‹åº](https://h3.dev/guide/basics/error)æ¥å¤„ç†è·¯ç”±å’Œä¸­é—´ä»¶ä¸­çš„é”™è¯¯ã€‚

é”™è¯¯å‘é€å›å®¢æˆ·ç«¯çš„æ–¹å¼å–å†³äºè·¯ç”±çš„è·¯å¾„ã€‚å¯¹äºå¤§å¤šæ•°è·¯ç”±ï¼Œé»˜è®¤æƒ…å†µä¸‹ `Content-Type` è®¾ç½®ä¸º `text/html`ï¼Œå¹¶æä¾›ä¸€ä¸ªç®€å•çš„ html é”™è¯¯é¡µé¢ã€‚å¦‚æœè·¯ç”±ä»¥ `/api/` å¼€å¤´ï¼ˆå› ä¸ºå®ƒä½äº `api/` æˆ– `routes/api/` ä¸­ï¼‰ï¼Œé»˜è®¤å°†æ›´æ”¹ä¸º `application/json`ï¼Œå¹¶å°†å‘é€ JSON å¯¹è±¡ã€‚

æ­¤è¡Œä¸ºå¯ä»¥è¢«æŸäº›è¯·æ±‚å±æ€§è¦†ç›–ï¼ˆä¾‹å¦‚ï¼š`Accept` æˆ– `User-Agent` å¤´ï¼‰ã€‚

## è·¯ç”±è§„åˆ™

Nitro å…è®¸ä½ åœ¨é…ç½®çš„æ¯ä¸ªè·¯ç”±çš„é¡¶çº§æ·»åŠ é€»è¾‘ã€‚å®ƒå¯ä»¥ç”¨äºé‡å®šå‘ã€ä»£ç†ã€ç¼“å­˜å’Œä¸ºè·¯ç”±æ·»åŠ å¤´ã€‚

å®ƒæ˜¯ä»è·¯ç”±æ¨¡å¼ï¼ˆéµå¾ª [rou3](https://github.com/h3js/rou3)ï¼‰åˆ°è·¯ç”±é€‰é¡¹çš„æ˜ å°„ã€‚

å½“è®¾ç½® `cache` é€‰é¡¹æ—¶ï¼ŒåŒ¹é…æ¨¡å¼çš„å¤„ç†å™¨å°†è‡ªåŠ¨ç”¨ `defineCachedEventHandler` åŒ…è£…ã€‚è¯·å‚é˜…[ç¼“å­˜æŒ‡å—](/docs/cache)ä»¥äº†è§£æœ‰å…³æ­¤å‡½æ•°çš„æ›´å¤šä¿¡æ¯ã€‚

::note
`swr: true|number` æ˜¯ `cache: { swr: true, maxAge: number }` çš„å¿«æ·æ–¹å¼
::

ä½ å¯ä»¥åœ¨ `nitro.routeRules` é€‰é¡¹ä¸­è®¾ç½®è·¯ç”±è§„åˆ™ã€‚

```ts [nitro.config.ts]
import { defineNitroConfig } from "nitro/config";

export default defineConfig({
  routeRules: {
    '/blog/**': { swr: true },
    '/blog/**': { swr: 600 },
    '/blog/**': { static: true },
    '/blog/**': { cache: { /* ç¼“å­˜é€‰é¡¹*/ } },
    '/assets/**': { headers: { 'cache-control': 's-maxage=0' } },
    '/api/v1/**': { cors: true, headers: { 'access-control-allow-methods': 'GET' } },
    '/old-page': { redirect: '/new-page' },
    '/old-page/**': { redirect: '/new-page/**' },
    '/proxy/example': { proxy: 'https://example.com' },
    '/proxy/**': { proxy: '/api/**' },
  }
});
```